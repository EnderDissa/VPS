databaseChangeLog:
  - changeSet:
      id: 1
      author: warehouse
      changes:
        - createTable:
            tableName: users
            columns:
              - column: {name: id, type: BIGINT, autoIncrement: true, constraints: {primaryKey: true, nullable: false}}
              - column: {name: first_name, type: VARCHAR(100), constraints: {nullable: false}}
              - column: {name: second_name, type: VARCHAR(100)}
              - column: {name: last_name, type: VARCHAR(100), constraints: {nullable: false}}
              - column: {name: role, type: VARCHAR(50), constraints: {nullable: false}}
              - column: {name: email, type: VARCHAR(255), constraints: {nullable: false, unique: true}}
              - column: {name: password_hash, type: VARCHAR(255), constraints: {nullable: false}}
              - column: {name: created_at, type: TIMESTAMP, defaultValueComputed: "CURRENT_TIMESTAMP"}
        
        - createTable:
            tableName: items
            columns:
              - column: {name: id, type: BIGINT, autoIncrement: true, constraints: {primaryKey: true, nullable: false}}
              - column: {name: name, type: VARCHAR(255), constraints: {nullable: false}}
              - column: {name: type, type: VARCHAR(50), constraints: {nullable: false}}
              - column: {name: condition, type: VARCHAR(50), constraints: {nullable: false}}
              - column: {name: serial_number, type: VARCHAR(100), constraints: {unique: true}}
              - column: {name: description, type: TEXT}
              - column: {name: created_at, type: TIMESTAMP, defaultValueComputed: "CURRENT_TIMESTAMP"}

        - createTable:
            tableName: storages
            columns:
              - column: {name: id, type: BIGINT, autoIncrement: true, constraints: {primaryKey: true, nullable: false}}
              - column: {name: name, type: VARCHAR(255), constraints: {nullable: false}}
              - column: {name: address, type: TEXT, constraints: {nullable: false}}
              - column: {name: capacity, type: INT}
              - column: {name: created_at, type: TIMESTAMP, defaultValueComputed: "CURRENT_TIMESTAMP"}

        - createTable:
            tableName: vehicles
            columns:
              - column: {name: id, type: BIGINT, autoIncrement: true, constraints: {primaryKey: true, nullable: false}}
              - column: {name: brand, type: VARCHAR(100), constraints: {nullable: false}}
              - column: {name: model, type: VARCHAR(100), constraints: {nullable: false}}
              - column: {name: license_plate, type: VARCHAR(20), constraints: {nullable: false, unique: true}}
              - column: {name: year, type: INT}
              - column: {name: capacity, type: INT}
              - column: {name: status, type: VARCHAR(20), constraints: {nullable: false}, defaultValue: "AVAILABLE"}

        - createTable:
            tableName: keeping
            columns:
              - column: {name: id, type: BIGINT, autoIncrement: true, constraints: {primaryKey: true, nullable: false}}
              - column: {name: storage_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: item_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: quantity, type: INT, constraints: {nullable: false}, defaultValue: "1"}
              - column: {name: shelf, type: VARCHAR(100)}
              - column: {name: last_updated, type: TIMESTAMP, defaultValueComputed: "CURRENT_TIMESTAMP"}

        - createTable:
            tableName: transportations
            columns:
              - column: {name: id, type: BIGINT, autoIncrement: true, constraints: {primaryKey: true, nullable: false}}
              - column: {name: item_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: vehicle_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: driver_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: from_storage_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: to_storage_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: status, type: VARCHAR(20), constraints: {nullable: false}, defaultValue: "PLANNED"}
              - column: {name: scheduled_departure, type: TIMESTAMP}
              - column: {name: actual_departure, type: TIMESTAMP}
              - column: {name: scheduled_arrival, type: TIMESTAMP}
              - column: {name: actual_arrival, type: TIMESTAMP}
              - column: {name: created_at, type: TIMESTAMP, defaultValueComputed: "CURRENT_TIMESTAMP"}

        - createTable:
            tableName: borrowings
            columns:
              - column: {name: id, type: BIGINT, autoIncrement: true, constraints: {primaryKey: true, nullable: false}}
              - column: {name: item_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: user_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: quantity, type: INT, constraints: {nullable: false}, defaultValue: "1"}
              - column: {name: borrow_date, type: TIMESTAMP, constraints: {nullable: false}, defaultValueComputed: "CURRENT_TIMESTAMP"}
              - column: {name: expected_return_date, type: TIMESTAMP, constraints: {nullable: false}}
              - column: {name: actual_return_date, type: TIMESTAMP}
              - column: {name: status, type: VARCHAR(20), constraints: {nullable: false}, defaultValue: "ACTIVE"}
              - column: {name: purpose, type: TEXT}

        - createTable:
            tableName: item_maintenance
            columns:
              - column: {name: id, type: BIGINT, autoIncrement: true, constraints: {primaryKey: true, nullable: false}}
              - column: {name: item_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: technician_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: maintenance_date, type: TIMESTAMP, constraints: {nullable: false}}
              - column: {name: next_maintenance_date, type: TIMESTAMP}
              - column: {name: cost, type: "DECIMAL(10,2)"}
              - column: {name: description, type: TEXT}
              - column: {name: status, type: VARCHAR(20), constraints: {nullable: false}, defaultValue: "COMPLETED"}
              - column: {name: created_at, type: TIMESTAMP, defaultValueComputed: "CURRENT_TIMESTAMP"}

        - createTable:
            tableName: user_storage_access
            columns:
              - column: {name: id, type: BIGINT, autoIncrement: true, constraints: {primaryKey: true, nullable: false}}
              - column: {name: user_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: storage_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: access_level, type: VARCHAR(20), constraints: {nullable: false}}
              - column: {name: granted_by, type: BIGINT, constraints: {nullable: false}}
              - column: {name: granted_at, type: TIMESTAMP, defaultValueComputed: "CURRENT_TIMESTAMP"}
              - column: {name: expires_at, type: TIMESTAMP}
              - column: {name: is_active, type: BOOLEAN, constraints: {nullable: false}, defaultValue: "true"}


        - addForeignKeyConstraint:
            baseTableName: keeping
            baseColumnNames: storage_id
            referencedTableName: storages
            referencedColumnNames: id
            constraintName: fk_keeping_storage

        - addForeignKeyConstraint:
            baseTableName: keeping
            baseColumnNames: item_id
            referencedTableName: items
            referencedColumnNames: id
            constraintName: fk_keeping_item

        - addForeignKeyConstraint:
            baseTableName: transportations
            baseColumnNames: item_id
            referencedTableName: items
            referencedColumnNames: id
            constraintName: fk_transportation_item

        - addForeignKeyConstraint:
            baseTableName: transportations
            baseColumnNames: vehicle_id
            referencedTableName: vehicles
            referencedColumnNames: id
            constraintName: fk_transportation_vehicle

        - addForeignKeyConstraint:
            baseTableName: transportations
            baseColumnNames: driver_id
            referencedTableName: users
            referencedColumnNames: id
            constraintName: fk_transportation_driver

        - addForeignKeyConstraint:
            baseTableName: transportations
            baseColumnNames: from_storage_id
            referencedTableName: storages
            referencedColumnNames: id
            constraintName: fk_transportation_from_storage

        - addForeignKeyConstraint:
            baseTableName: transportations
            baseColumnNames: to_storage_id
            referencedTableName: storages
            referencedColumnNames: id
            constraintName: fk_transportation_to_storage

        - addForeignKeyConstraint:
            baseTableName: borrowings
            baseColumnNames: item_id
            referencedTableName: items
            referencedColumnNames: id
            constraintName: fk_borrowing_item

        - addForeignKeyConstraint:
            baseTableName: borrowings
            baseColumnNames: user_id
            referencedTableName: users
            referencedColumnNames: id
            constraintName: fk_borrowing_user

        - addForeignKeyConstraint:
            baseTableName: item_maintenance
            baseColumnNames: item_id
            referencedTableName: items
            referencedColumnNames: id
            constraintName: fk_maintenance_item

        - addForeignKeyConstraint:
            baseTableName: item_maintenance
            baseColumnNames: technician_id
            referencedTableName: users
            referencedColumnNames: id
            constraintName: fk_maintenance_technician
            
        - addForeignKeyConstraint:
            baseTableName: user_storage_access
            baseColumnNames: user_id
            referencedTableName: users
            referencedColumnNames: id
            constraintName: fk_access_user

        - addForeignKeyConstraint:
            baseTableName: user_storage_access
            baseColumnNames: storage_id
            referencedTableName: storages
            referencedColumnNames: id
            constraintName: fk_access_storage

        - addForeignKeyConstraint:
            baseTableName: user_storage_access
            baseColumnNames: granted_by
            referencedTableName: users
            referencedColumnNames: id
            constraintName: fk_access_granted_by

        - addUniqueConstraint:
            tableName: user_storage_access
            columnNames: user_id, storage_id
            constraintName: uk_user_storage_access

        - createIndex:
            indexName: idx_keeping_storage_item
            tableName: keeping
            columns:
              - column: {name: storage_id}
              - column: {name: item_id}

        - createIndex:
            indexName: idx_borrowing_status
            tableName: borrowings
            columns:
              - column: {name: status}

        - createIndex:
            indexName: idx_transportation_status
            tableName: transportations
            columns:
              - column: {name: status}